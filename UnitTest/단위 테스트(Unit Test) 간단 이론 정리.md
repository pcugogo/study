# 단위 테스트 (Unit Test) 간단 이론 정리

단위 테스트는 컴퓨터 프로그래밍에서 소스 코드의 **특정 모듈이 의도된 대로 정확히 작동하는지 검증하는 절차**다. 즉, **모든 함수와 메소드에 대한 테스트 케이스(Test case)를 작성하는 절차**를 말한다.

이를 통해서 언제라도 코드 변경으로 인해 문제가 발생할 경우, 단시간 내에 이를 파악하고 바로 잡을 수 있도록 해준다. 

이상적으로, 각 테스트 케이스는 서로 분리되어야 한다. 이를 위해 가짜 객체(Mock object)를 생성하는 것도 좋은 방법이다. 유닛 테스트는 (일반적인 테스트와 달리) 개발자(developer) 뿐만 아니라 보다 더 심도있는 테스트를 위해 테스터(tester)에 의해 수행되기도 한다.

[by. 위키백과](https://ko.wikipedia.org/wiki/%EC%9C%A0%EB%8B%9B_%ED%85%8C%EC%8A%A4%ED%8A%B8)

예를 들어 앱의 페이지네이션 기능을 테스트할 때, loadMore 메소드 실행 결과로 page가 하나 증가하였는 지에 대한 테스트가 1개의 단위 테스트가 될 수 있다.

## 왜 유닛 테스트를 할까?
- 코드 변경으로 인해 문제가 발생할 경우, 단시간 내에 이를 파악하고 바로 잡을 수 있도록 해준다. 
- 리팩토링 시에 테스트 코드가 작성되어 있는 경우, 이전에 어떤 동작을 했었는 지 쉽게 파악할 수 있다. 어떤 글의 내용에 의하면 좋은 유닛 테스트는 프로젝트 문서 역할까지도 할 수 있다고 한다.
- 완성된 테스트 코드가 있는 경우, 버그나 동작의 변화 등 각종 Side Effects를 신경 쓰지 않고 코드 퀄리티에만 집중하여 리팩토링할 수 있다.

## 좋고 깨끗한 테스트 코드를 짜기 위한 몇 가지 규칙 (클린 코드 by. 로버트 C. 마틴 도서 내용 중)

- 한 개의 테스트 함수에 assert 문을 하나만 사용해라 
 - assert 문이 단 하나인 함수는 결론이 하나라서 코드를 이해하기 쉽고 빠르다. 그렇지만 때때로 assert문이 하나만 사용하는 것이 비효율적인 때(테스트 케이스를 분리하므로서 코드가 너무 길어짐, 분리하므로서 불필요한 코드 설계가 필요할 수 있음)가 있다. 그렇기때문에 최소화한다는 개념으로 이해하면 되겠다.
- 각 테스트 함수는 한 개념만을 테스트해라
 - 위 내용처럼 어떤 테스트 케이스에서는 assert를 하나만 사용하는 것은 비효율적일 수 있다.  그렇기때문에 assert를 하나 사용하는 것으로 생각하기보단 한 개념만을 테스트하는 것으로 생각하고 테스트 코드를 작성하면 좋을 것 같다.

### FIRST
- Fast 빠르게: 테스트는 빠르게 동작해야한다. 느리면 자주 돌릴 엄두를 못 낸다.
- Independent 독립적으로: 각 테스트는 서로 의존하면 안된다. 한 테스트가 다음 테스트가 실행될 환경을 준비해서는 안된다. 각 테스트는 독립적으로 그리고 어떤 순서로 실행해도 괜찮아야 한다.
- Repeatable 반복가능하게: 어떤 환경에서도 반복 가능해야 한다. 네트워크가 연결되지 않은 상태에서도 테스트가 가능해야한다. -> ***서버 상태와 상관 없이 앱에 대한 테스트를 해야한다.***
- Self-Validating 자가검증하는: 테스트는 성공 아니면 실패로 Bool 값으로 결과를 내야 하고 테스트가 스스로 성공과 실패를 검증해야한다.
- Timely 적시에: 테스트는 적시에 작성해야한다. 단위 테스트는 테스트하려는 실제 코드를 구현하기 직전에 구현한다. 실제 코드를 구현한 다음에 테스트 코드를 만들면 실제 코드가 테스트하기 어렵다는 사실을 발견할지도 모른다.

## Mock, Stub
테스트 코드 관련해서 Mock, Stub와 같은 용어를 많이 들어봤을 것이다. 두 용어 모두 테스트를 할 때 실제 객체를 대신해서 사용되는 객체이고 모두 Test Double이라고 부른다. Test Double에는 Dummy, Fake, Stub, Spy, Mock이 있고 각  Test Double 마다 역할이 조금씩 다르다.(그런데 굳이 각 TestDouble들의 역할에 맞게 각 이름을 지어주지 않고 편의상 Stub만을 사용하는 경우가 많은 것 같다.) Test Double이란 이름이 왜 지어지게 되었는 지를 살펴보면 왜 Mock, Stub이 필요한지 이해하는데 도움이 되는데, [마틴파울러의 블로그 내용](https://martinfowler.com/articles/mocksArentStubs.html)에 의하면 **Test Double은 영화 촬영 시 사용되는 스턴트 더블이라는 개념에서 비롯 되었다고 한다. 즉 Mock이나 Stub은 실제 객체의 스턴트 맨 역할을 한다. 예를 들어 실제 API의 응답과 동일한 데이터를 응답하는 가짜 API 객체를 역할에 따라 Mock 이나 Stub라고 할 수 있다.**

추가로 실제 API를 사용하면 안되는 이유를 굳이 나열해 보자면 FIRST 원칙 중 F와 R의 조건을 지키지 못하고 또 많은 테스트 함수가 실행 될 때마다 API에 요청을 하는 것은 비용적으로 문제가 있고 또 앱 개발자인 우리가 해야하는 테스트는 앱의 기능을 테스트하는 것이지 API 상태를 테스트하는 것이 아니기때문이다.

## Dependency Injection (의존성 주입)
실제 코드는 실제 API를 호출해야하고 테스트 코드는 Mock API를 호출을 해야한다. 이렇게 작동하도록 하기위해 API 객체를 갖는 객체에서 실제 API 객체를 갖고 API 객체에 의존하는 것이 아닌 API 기능들을 명세한 Protocol을 만들고 이 Protocol을 의존하게 하여 외부에서 이 프로토콜을 채택한 객체를 주입 받도록 하면 된다.


## 참고 자료

[by. 위키백과](https://ko.wikipedia.org/wiki/%EC%9C%A0%EB%8B%9B_%ED%85%8C%EC%8A%A4%ED%8A%B8)

[마틴파울러의 블로그](https://martinfowler.com/articles/mocksArentStubs.html)

클린 코드 by. 로버트 C. 마틴 도서 내용